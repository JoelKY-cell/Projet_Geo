# ğŸ” CONFIGURATION ADMIN SYSTÃˆME & ADMINS ENTREPRISE

## ğŸ“‹ HIÃ‰RARCHIE DES RÃ”LES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPER ADMIN (Admin SystÃ¨me)              â”‚
â”‚  - AccÃ¨s global toutes entreprises                          â”‚
â”‚  - CrÃ©e les entreprises                                     â”‚
â”‚  - CrÃ©e les Admins d'entreprise                             â”‚
â”‚  - company = NULL                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ENTREPRISE A      â”‚              â”‚  ENTREPRISE B          â”‚
â”‚                    â”‚              â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ADMIN        â”‚  â”‚              â”‚  â”‚ ADMIN        â”‚     â”‚
â”‚  â”‚ - GÃ¨re tout  â”‚  â”‚              â”‚  â”‚ - GÃ¨re tout  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚          â”‚              â”‚         â”‚             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”‚              â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”        â”‚
â”‚    â”‚         â”‚     â”‚              â”‚    â”‚         â”‚        â”‚
â”‚  â”Œâ”€â–¼â”€â”€â”   â”Œâ”€â–¼â”€â”€â”  â”‚              â”‚  â”Œâ”€â–¼â”€â”€â”   â”Œâ”€â–¼â”€â”€â”     â”‚
â”‚  â”‚SUP â”‚   â”‚SUP â”‚  â”‚              â”‚  â”‚SUP â”‚   â”‚SUP â”‚     â”‚
â”‚  â””â”€â”¬â”€â”€â”˜   â””â”€â”¬â”€â”€â”˜  â”‚              â”‚  â””â”€â”¬â”€â”€â”˜   â””â”€â”¬â”€â”€â”˜     â”‚
â”‚    â”‚        â”‚      â”‚              â”‚    â”‚        â”‚        â”‚
â”‚  â”Œâ”€â–¼â”€â”   â”Œâ”€â–¼â”€â”    â”‚              â”‚  â”Œâ”€â–¼â”€â”   â”Œâ”€â–¼â”€â”       â”‚
â”‚  â”‚USRâ”‚   â”‚USRâ”‚    â”‚              â”‚  â”‚USRâ”‚   â”‚USRâ”‚       â”‚
â”‚  â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜    â”‚              â”‚  â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘‘ SUPER ADMIN (Admin SystÃ¨me)

### CaractÃ©ristiques
```python
role = 'super_admin'
company = None  # OBLIGATOIRE
is_superuser = True
```

### Droits
âœ… CrÃ©er/modifier/supprimer des entreprises
âœ… CrÃ©er l'Admin principal de chaque entreprise
âœ… Voir toutes les entreprises
âœ… Voir tous les utilisateurs (toutes entreprises)
âœ… AccÃ©der Ã  toutes les donnÃ©es (vÃ©hicules, tracking, etc.)
âœ… AccÃ¨s complet Ã  l'admin Django

### Restrictions
âŒ Ne peut pas Ãªtre supprimÃ© par un Admin d'entreprise
âŒ Ne doit jamais avoir de `company` assignÃ©e

### CrÃ©ation
```bash
python manage.py createsuperuser
# Puis dans le shell:
python manage.py shell
>>> from users.models import User
>>> user = User.objects.get(username='Tanga')
>>> user.role = 'super_admin'
>>> user.save()
```

---

## ğŸ¢ ADMIN D'ENTREPRISE

### CaractÃ©ristiques
```python
role = 'admin'
company = Company.objects.get(id=X)  # OBLIGATOIRE
```

### Droits
âœ… GÃ©rer tous les modules de SA entreprise uniquement
âœ… CrÃ©er/modifier/dÃ©sactiver:
   - Superviseurs de son entreprise
   - Utilisateurs simples de son entreprise
âœ… GÃ©rer:
   - VÃ©hicules de son entreprise
   - BoÃ®tiers GPS de son entreprise
   - Conducteurs de son entreprise
   - Alertes de son entreprise
   - Rapports de son entreprise

### Restrictions
âŒ Ne peut pas crÃ©er d'entreprise
âŒ Ne peut pas crÃ©er d'Admin (ni pour sa company, ni pour une autre)
âŒ Ne peut pas accÃ©der aux donnÃ©es d'une autre entreprise
âŒ Ne peut pas supprimer le Super Admin
âŒ Ne peut pas Ãªtre supprimÃ© par un Superviseur

### CrÃ©ation (par Super Admin uniquement)
```python
# Via API: POST /api/companies/{id}/create_admin/
{
    "username": "admin_entrepriseA",
    "email": "admin@entrepriseA.com",
    "password": "password123",
    "first_name": "Admin",
    "last_name": "Entreprise A"
}
```

---

## ğŸ‘¨ğŸ’¼ SUPERVISEUR

### CaractÃ©ristiques
```python
role = 'supervisor'
company = Company.objects.get(id=X)  # OBLIGATOIRE
```

### Droits
âœ… CrÃ©er des utilisateurs simples de son entreprise
âœ… Consulter toutes les donnÃ©es de son entreprise
âœ… Superviser les activitÃ©s
âœ… GÃ©rer les vÃ©hicules et boÃ®tiers

### Restrictions
âŒ Ne peut pas crÃ©er d'Admin
âŒ Ne peut pas crÃ©er d'autre Superviseur
âŒ Ne peut pas supprimer d'Admin
âŒ Ne peut pas accÃ©der aux donnÃ©es d'une autre entreprise

### CrÃ©ation (par Admin d'entreprise)
```python
# Via API: POST /api/users/
{
    "username": "supervisor1",
    "email": "supervisor@entrepriseA.com",
    "password": "password123",
    "role": "supervisor",
    "company": 1  # ID de l'entreprise
}
```

---

## ğŸ‘¤ UTILISATEUR SIMPLE

### CaractÃ©ristiques
```python
role = 'user'
company = Company.objects.get(id=X)  # OBLIGATOIRE
```

### Droits
âœ… Consultation uniquement
âœ… Voir les vÃ©hicules de son entreprise
âœ… Voir les positions GPS
âœ… Voir les rapports

### Restrictions
âŒ Aucune crÃ©ation/modification/suppression
âŒ Lecture seule

### CrÃ©ation (par Admin ou Superviseur)
```python
# Via API: POST /api/users/
{
    "username": "user1",
    "email": "user@entrepriseA.com",
    "password": "password123",
    "role": "user",
    "company": 1
}
```

---

## ğŸ”„ FLUX DE CRÃ‰ATION DES COMPTES

### 1ï¸âƒ£ CrÃ©ation d'une entreprise
```
Super Admin â†’ POST /api/companies/
{
    "name": "Entreprise A"
}
```

### 2ï¸âƒ£ CrÃ©ation de l'Admin d'entreprise
```
Super Admin â†’ POST /api/companies/{id}/create_admin/
{
    "username": "admin_A",
    "email": "admin@entrepriseA.com",
    "password": "password123"
}
```

### 3ï¸âƒ£ CrÃ©ation de Superviseurs
```
Admin Entreprise â†’ POST /api/users/
{
    "username": "supervisor1",
    "role": "supervisor",
    "company": 1
}
```

### 4ï¸âƒ£ CrÃ©ation d'Utilisateurs Simples
```
Admin ou Superviseur â†’ POST /api/users/
{
    "username": "user1",
    "role": "user",
    "company": 1
}
```

---

## ğŸ” RÃˆGLES DE SÃ‰CURITÃ‰

### Isolation par Entreprise
```python
# Dans les ViewSets
def get_queryset(self):
    if self.request.user.is_super_admin():
        return Model.objects.all()
    return Model.objects.filter(company=self.request.user.company)
```

### Validation des Permissions
```python
# Dans les Serializers
def validate(self, data):
    user = self.context['request'].user
    
    if user.is_admin():
        # Ne peut crÃ©er que supervisor et user
        if data['role'] not in ['supervisor', 'user']:
            raise ValidationError("Interdit")
    
    if user.is_supervisor():
        # Ne peut crÃ©er que user
        if data['role'] != 'user':
            raise ValidationError("Interdit")
```

### Protection contre la Suppression
```python
def perform_destroy(self, instance):
    # EmpÃªcher suppression Super Admin
    if instance.is_super_admin():
        raise PermissionError("Impossible")
    
    # EmpÃªcher suppression Admin par non-super-admin
    if instance.is_admin() and not user.is_super_admin():
        raise PermissionError("Interdit")
```

---

## ğŸ“Š MATRICE DES PERMISSIONS

| Action | Super Admin | Admin | Supervisor | User |
|--------|-------------|-------|------------|------|
| CrÃ©er Entreprise | âœ… | âŒ | âŒ | âŒ |
| CrÃ©er Admin | âœ… | âŒ | âŒ | âŒ |
| CrÃ©er Supervisor | âœ… | âœ… | âŒ | âŒ |
| CrÃ©er User | âœ… | âœ… | âœ… | âŒ |
| Voir toutes entreprises | âœ… | âŒ | âŒ | âŒ |
| Voir sa company | âœ… | âœ… | âœ… | âœ… |
| GÃ©rer vÃ©hicules | âœ… | âœ… | âœ… | âŒ |
| Voir positions GPS | âœ… | âœ… | âœ… | âœ… |
| Supprimer Admin | âœ… | âŒ | âŒ | âŒ |

---

## ğŸš€ ENDPOINTS API

### Entreprises (Super Admin uniquement)
```
GET    /api/companies/              # Liste entreprises
POST   /api/companies/              # CrÃ©er entreprise
GET    /api/companies/{id}/         # DÃ©tails entreprise
PUT    /api/companies/{id}/         # Modifier entreprise
DELETE /api/companies/{id}/         # Supprimer entreprise
POST   /api/companies/{id}/create_admin/  # CrÃ©er admin entreprise
```

### Utilisateurs (Selon rÃ´le)
```
GET    /api/users/                  # Liste (filtrÃ©e par company)
POST   /api/users/                  # CrÃ©er utilisateur
GET    /api/users/{id}/             # DÃ©tails utilisateur
PUT    /api/users/{id}/             # Modifier utilisateur
DELETE /api/users/{id}/             # DÃ©sactiver utilisateur
```

---

## âœ… CHECKLIST DE CONFIGURATION

- [x] ModÃ¨le User avec 4 rÃ´les
- [x] ModÃ¨le Company
- [x] Permissions DRF (IsSuperAdmin, IsAdmin, IsSupervisor)
- [x] Serializers avec validation par rÃ´le
- [x] ViewSets avec isolation par company
- [x] Middleware d'isolation
- [x] Protection contre suppression Super Admin
- [x] Validation crÃ©ation utilisateurs selon hiÃ©rarchie
- [x] Frontend avec menu adaptÃ© par rÃ´le

---

## ğŸ¯ RÃ‰SUMÃ‰

**Super Admin** â†’ GÃ¨re tout le systÃ¨me
**Admin** â†’ GÃ¨re son entreprise
**Supervisor** â†’ CrÃ©e des users, supervise
**User** â†’ Consultation uniquement

**Isolation stricte** â†’ Chaque entreprise voit uniquement ses donnÃ©es
**SÃ©curitÃ©** â†’ Validation Ã  tous les niveaux (serializer, view, permission)
**Ã‰volutif** â†’ Ajout facile de nouvelles entreprises

**Architecture SaaS multi-tenant production-ready!** ğŸ‰
